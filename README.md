# Домашнее задание к занятию "13.Системы мониторинга"

## Основная часть   

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?   

<details>
<summary>Ответ</summary>
<br>

Минимум надо вывести метрики по ЦПУ (загрузка), дискам (объем занятого места) и метрики по http запросам (количество и ошибки).
Согласно Подходу SRE разработал Google, эти метрики входят в Четыре золотых сигнала в подходе SRE.   


</details>  

2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. 
Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. 
Что вы можете ему предложить?   

<details>
<summary>Ответ</summary>
<br>

Для того что бы привести метрики в понятный вид, нужно утвердить SLA в рамках, которого будут указаны SLO для тех метрик.
После этого менежджерам будет видна разница значений SLO и SLI. Если значения SLI метрики не противоречат установленным для нее SLO тогда продукт в норме. 
Менеджер видит работоспособность продукта.

</details>  

3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. 
Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. 
Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?   

<details>
<summary>Ответ</summary>
<br>
 
Можно использовать бесплатную облачную версию Sentry, она должна покрыть потребности разработки.

</details>  

4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. 
Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

<details>
<summary>Ответ</summary>
<br>

Правильная формула расчёта уровня предоставляемого обслуживания выглядит так: 
(summ_2xx_requests + summ_3xx_requests)/(summ_all_requests)

</details>

5. Опишите основные плюсы и минусы pull и push систем мониторинга.   

<details>
<summary>Ответ</summary>
<br>

Push системы удобно использовать когда собирается большое количество метрик и неустойчивый канал связи между агентами и системой мониторинга. 
Можно переключать передачу данных между udp и tcp, тем самым выбирая между экономией трафика или гарантией доставки. 
Гибкая настройка частоты и объёма передаваемых метрик. 
К плюсам данной модели можно отнести её использование в динамически меняющемся окружении, т.к. метрики с агентов сами будут поступать в систему мониторинга без её дополнительной настройки.   

Pull системы мониторинга позволяют контролировать источники откуда принимать метрики. 
Можно защитить канал связи между агентами и системой мониторинга шифрованием. 
Упрощённая отладка получения метрик с агентов. 
К минусам можно отнести сложность мониторинга динамически изменяющегося окружения

</details>

6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?   

<details>
<summary>Ответ</summary>
<br>

Prometheus - Pull. Можно отправлять метрики по Push модели при помощи push gateway, но Prometheus будет из забирать как pull   
TICK Push. Агент Telegraf отправляет данные в БД InfluxDB. Telegraf при этом можно настроить на работу по Pull модели   
Zabbix - Push и Pull   
VictoriaMetrics - Push   
Nagios - Pull   

</details>   

7. Склонируйте себе репозиторий и запустите TICK-стэк, используя технологии docker и docker-compose.
В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (http://localhost:8888).   

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим Z, например ./data:/var/lib:Z   

<details>
<summary>Ответ</summary>
<br>

 ![Снимок экрана 2023-08-31 в 07 35 40](https://github.com/tomaevmax/devops-netology/assets/32243921/9afe69fb-bc23-428e-b1de-f2394dae8507)

</details>  

8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.   

Нажмите на кнопку Add a query   
Изучите вывод интерфейса и выберите БД telegraf.autogen   
В measurments выберите cpu->host->telegraf-getting-started, а в fields выберите usage_system.    
Внизу появится график утилизации cpu.   
Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису.    
Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.   
Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.   

<details>
<summary>Ответ</summary>
<br>

![Снимок экрана 2023-08-31 в 07 42 00](https://github.com/tomaevmax/devops-netology/assets/32243921/f9ad839e-3592-4575-be9b-ceb3155fc348)

</details>  

9. Изучите список telegraf inputs. Добавьте в конфигурацию telegraf следующий плагин - docker:
    
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"   
  
Дополнительно вам может потребоваться донастройка контейнера telegraf в docker-compose.yml дополнительного volume и режима privileged:
После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список measurments в веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.   

<details>
<summary>Ответ</summary>
<br>

![Снимок экрана 2023-08-31 в 08 05 23](https://github.com/tomaevmax/devops-netology/assets/32243921/e96644d5-128c-4d78-b414-a3e842c77214)

</details>  
