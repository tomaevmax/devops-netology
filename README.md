
# Домашнее задание "Введение в Ansible"   

## Задача 1   
Попробуйте запустить playbook на окружении из test.yml, зафиксируйте значение, которое имеет факт some_fact для указанного хоста при выполнении playbook.   

## Ответ    

````
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/test.yml site.yml 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform darwin on host localhost is using the discovered Python interpreter at /opt/homebrew/bin/python3.11, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "MacOSX"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": 12
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   


````   

## Задача 2  
Найдите файл с переменными (group_vars), в котором задаётся найденное в первом пункте значение, и поменяйте его на all default fact.   

## Ответ  

[examp.yml](/playbook/group_vars/all/examp.yml)  
````   
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/test.yml site.yml

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform darwin on host localhost is using the discovered Python interpreter at /opt/homebrew/bin/python3.11, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "MacOSX"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [localhost] => {
    "msg": "all default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

````   
## Задача 4  
Проведите запуск playbook на окружении из prod.yml. Зафиксируйте полученные значения some_fact для каждого из managed host.   

## Ответ  

````
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/prod.yml site.yml     

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container]
[WARNING]: Distribution Ubuntu 18.04 on host Ubuntu1804 should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [Ubuntu1804]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "CentOS"
}
ok: [Ubuntu1804] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "el"
}
ok: [Ubuntu1804] => {
    "msg": "deb"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
Ubuntu1804                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
centos-container           : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   
````   
## Задача 5  
Добавьте факты в group_vars каждой из групп хостов так, чтобы для some_fact получились значения: для deb — deb default fact, для el — el default fact.   

## Ответ  

[deb/examp.yml](/playbook/group_vars/deb/examp.yml)  
[el/examp.yml](/playbook/group_vars/el/examp.yml)  

## Задача 6  
Повторите запуск playbook на окружении prod.yml. Убедитесь, что выдаются корректные значения для всех хостов.   

## Ответ  

````
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/prod.yml site.yml     

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container]
[WARNING]: Distribution Ubuntu 18.04 on host Ubuntu1804 should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [Ubuntu1804]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "CentOS"
}
ok: [Ubuntu1804] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "el default fact"
}
ok: [Ubuntu1804] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
Ubuntu1804                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
centos-container           : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
````   
## Задача 7  
При помощи ansible-vault зашифруйте факты в group_vars/deb и group_vars/el с паролем netology.


## Ответ  
[deb/examp.yml](/playbook/group_vars/deb/examp.yml)  
[el/examp.yml](/playbook/group_vars/el/examp.yml)     

## Задача 8  

Запустите playbook на окружении prod.yml. При запуске ansible должен запросить у вас пароль. Убедитесь в работоспособности.   

## Ответ  
````   
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container]
[WARNING]: Distribution Ubuntu 18.04 on host Ubuntu1804 should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [Ubuntu1804]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "CentOS"
}
ok: [Ubuntu1804] => {
    "msg": "Ubuntu"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "el default fact"
}
ok: [Ubuntu1804] => {
    "msg": "deb default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
Ubuntu1804                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
centos-container           : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
````   
## Задача 9  
Посмотрите при помощи ansible-doc список плагинов для подключения. Выберите подходящий для работы на control node.    

## Ответ  

ansible-doc -t connection -l 
Подойдет плагин ansible.builtin.local

## Задача 10   

В prod.yml добавьте новую группу хостов с именем  local, в ней разместите localhost с необходимым типом подключения.   

## Ответ  

[prod.yml](/inventory/prod.yml)     

## Задача 11   
Запустите playbook на окружении prod.yml. При запуске ansible должен запросить у вас пароль. Убедитесь, что факты some_fact для каждого из хостов определены из верных group_vars.   

## Ответ   

````
➜  playbook git:(ansible-dz1) ✗ ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
Vault password: 

PLAY [Print os facts] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform darwin on host localhost is using the discovered Python interpreter at /opt/homebrew/bin/python3.11, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [localhost]
ok: [centos-container]
[WARNING]: Distribution Ubuntu 18.04 on host Ubuntu1804 should use /usr/bin/python3, but is using /usr/bin/python2.7, since the discovered platform python interpreter was not present. See https://docs.ansible.com/ansible-core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [Ubuntu1804]

TASK [Print OS] ***************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "CentOS"
}
ok: [Ubuntu1804] => {
    "msg": "Ubuntu"
}
ok: [localhost] => {
    "msg": "MacOSX"
}

TASK [Print fact] *************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos-container] => {
    "msg": "el default fact"
}
ok: [Ubuntu1804] => {
    "msg": "deb default fact"
}
ok: [localhost] => {
    "msg": "all default fact"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
Ubuntu1804                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
centos-container           : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

````   
