# Домашнее задание к занятию 4 «Работа с roles»

## Задача
1. Создайте в старой версии playbook файл requirements.yml и заполните его содержимым:   

## Ответ
[requirements.yml](/playbook/requirements.yml) 

## Задача   
2. При помощи ansible-galaxy скачайте себе эту роль.   

## Ответ    
````
 playbook git:(ansible-dz4) ✗ ansible-galaxy install -r requirements.yml -p roles
Starting galaxy role install process
- extracting clickhouse to /Users/maksimtomaev/Downloads/repa/devops-netology/playbook/roles/clickhouse
- clickhouse (1.11.0) was installed successfully

````

## Задача   
3. Создайте новый каталог с ролью при помощи ansible-galaxy role init vector-role.   

## Ответ    
````   
 playbook git:(ansible-dz4) ✗ ansible-galaxy role init vector-role --init-path roles   
- Role vector-role was created successfully   
````   
## Задача  
4. На основе tasks из старого playbook заполните новую role. Разнесите переменные между vars и default.
5. Перенести нужные шаблоны конфигов в templates.  

## Ответ    
[default](https://github.com/tomaevmax/vector-role/blob/master/defaults/main.yml)   
[vars](https://github.com/tomaevmax/vector-role/blob/master/vars/main.yml)   

## Задача  
6. Опишите в README.md обе роли и их параметры. Пример качественной документации ansible role по ссылке.   

## Ответ
[README.md](https://github.com/tomaevmax/vector-role/blob/master/README.md)

## Задача  
7. Повторите шаги 3–6 для LightHouse. Помните, что одна роль должна настраивать один продукт.

## Ответ   
[README.md](https://github.com/tomaevmax/lighthouse-role/blob/master/README.md)   

## Задача  
8. Выложите все roles в репозитории. Проставьте теги, используя семантическую нумерацию. Добавьте roles в requirements.yml в playbook.   

## Ответ  
[vector-role repa](https://github.com/tomaevmax/vector-role)  
[lighthouse-role repa](https://github.com/tomaevmax/lighthouse-role/tree/master)  
[requirements](playbook/requirements.yml)   

## Задача  
9. Переработайте playbook на использование roles. Не забудьте про зависимости LightHouse и возможности совмещения roles с tasks.   

## Ответ  
[playbook](playbook/site.yml)   

## Задача  
Выложите playbook в репозиторий.
В ответе дайте ссылки на оба репозитория с roles и одну ссылку на репозиторий с playbook.   

## Ответ  
[vector-role repa](https://github.com/tomaevmax/vector-role)  
[lighthouse-role repa](https://github.com/tomaevmax/lighthouse-role)  
[playbook repa](https://github.com/tomaevmax/devops-netology/tree/ansible-dz4)

## Проверям отработку ролей  
````
➜  playbook git:(ansible-dz4) ✗ ansible-playbook -i inventory/prod.yml site.yml -l vector

PLAY [Install Clickhouse] *****************************************************************************************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY [Install Vector] *********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
The authenticity of host '62.84.113.147 (62.84.113.147)' can't be established.
ED25519 key fingerprint is SHA256:YUTzcnEtjsktbEOLCVcHnulQC86bTaea3oqZ1KHm78A.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
ok: [vector-01]

TASK [vector-role : Get vector distrib] ***************************************************************************************************************************************************************************************************************************************************************************
changed: [vector-01]

TASK [vector-role : Install vector packages] **********************************************************************************************************************************************************************************************************************************************************************
changed: [vector-01]

TASK [vector-role : Flush handlers] *******************************************************************************************************************************************************************************************************************************************************************************

RUNNING HANDLER [vector-role : Start vector service] **************************************************************************************************************************************************************************************************************************************************************
changed: [vector-01]

PLAY [Install nginx] **********************************************************************************************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY [Install Lighthouse] *****************************************************************************************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
vector-01                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
````   

````   
➜  playbook git:(ansible-dz4) ✗ ansible-playbook -i inventory/prod.yml site.yml -l lighthouse

PLAY [Install Clickhouse] *****************************************************************************************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY [Install Vector] *********************************************************************************************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY [Install nginx] **********************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
The authenticity of host '62.84.113.193 (62.84.113.193)' can't be established.
ED25519 key fingerprint is SHA256:3BNNjFWSbBtXlra5FFSv0YXTtpoA87++FhHgsYtxTL8.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
ok: [lighthouse-01]

TASK [NGINX | Install epel-release] *******************************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

TASK [NGINX | Install nginx] **************************************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

TASK [NGINX | Create general config] ******************************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

RUNNING HANDLER [Start nginx] *************************************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

RUNNING HANDLER [Reload nginx] ************************************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

PLAY [Install Lighthouse] *****************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [lighthouse-role : Lighthouse | install git] *****************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

TASK [lighthouse-role : Lighthouse | Copy from git] ***************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

TASK [lighthouse-role : Lighthouse | Create lighthouse config] ****************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

RUNNING HANDLER [lighthouse-role : Reload nginx] ******************************************************************************************************************************************************************************************************************************************************************
changed: [lighthouse-01]

PLAY RECAP ********************************************************************************************************************************************************************************************************************************************************************************************************
lighthouse-01              : ok=11   changed=9    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
````   
